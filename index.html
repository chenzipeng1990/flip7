<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="touch-action" content="manipulation"> <!-- 禁用移动端默认触摸行为 -->
    <title>7连翻游戏记分版</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent; /* 去除移动端点击高亮 */
        }
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center; /* 垂直居中核心 */
            padding: 20px;
            background-color: #f5f5f5;
            min-height: 100vh; /* 让body占满屏幕高度 */
        }
        .main-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 100%;
            max-width: 600px; /* 限制最大宽度，避免内容过宽 */
        }
        .score-container {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 40px; /* 增加底部间距，视觉更舒适 */
            justify-content: center; /* 计分块水平居中 */
            width: 100%;
        }
        .score-block {
            width: 80px;
            height: 80px;
            background-color: #2c3e50;
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 24px;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.2s;
            user-select: none; /* 禁止选中文本 */
            touch-action: none; /* 禁止触摸默认行为 */
        }
        .score-block:active {
            background-color: #34495e; /* 点击反馈 */
        }
        .score-block.long-press {
            background-color: #e74c3c; /* 长按变红 */
        }
        .add-btn {
            width: 80px;
            height: 80px;
            background-color: #ecf0f1;
            border: 2px dashed #bdc3c7;
            color: #7f8c8d;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 36px;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.2s;
            touch-action: none;
        }
        .add-btn:active {
            background-color: #e0e6e8;
        }
        .clear-btn {
            padding: 12px 40px; /* 加宽按钮，视觉更协调 */
            background-color: #2c3e50;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 18px;
            cursor: pointer;
            transition: background-color 0.2s;
            touch-action: manipulation;
            margin-top: 10px;
        }
        .clear-btn:active {
            background-color: #34495e;
        }
        /* 自定义弹窗样式（适配移动端） */
        .custom-prompt {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }
        .prompt-dialog {
            background: white;
            padding: 25px;
            border-radius: 10px;
            width: 85%;
            max-width: 320px;
        }
        .prompt-title {
            font-size: 17px;
            color: #333;
            margin-bottom: 20px;
            text-align: center;
        }
        .prompt-input {
            width: 100%;
            padding: 12px;
            font-size: 18px;
            border: 1px solid #ddd;
            border-radius: 6px;
            margin-bottom: 20px;
            text-align: center;
        }
        .prompt-btns {
            display: flex;
            gap: 10px;
            justify-content: center;
        }
        .prompt-btn {
            padding: 10px 25px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
        }
        .btn-cancel {
            background-color: #ecf0f1;
            color: #7f8c8d;
        }
        .btn-confirm {
            background-color: #2c3e50;
            color: white;
        }
    </style>
</head>
<body>
    <div class="main-container">
        <div class="score-container">
            <div class="score-block" data-score="0">0</div>
            <div class="score-block" data-score="0">0</div>
            <div class="add-btn">+</div>
        </div>
        <button class="clear-btn">清空</button>
    </div>

    <script>
        const scoreContainer = document.querySelector('.score-container');
        const addBtn = document.querySelector('.add-btn');
        const clearBtn = document.querySelector('.clear-btn');
        const LONG_PRESS_TIME = 800; // 长按触发时间
        let pressTimer = null;
        let isLongPress = false; // 标记是否触发了长按

        // 初始化单个计分块的事件（点击+长按）
        function initBlockEvents(block) {
            // 触摸开始（移动端核心）
            block.addEventListener('touchstart', (e) => {
                e.preventDefault(); // 阻止默认行为（如滚动、缩放）
                startPress(block);
            });

            // 鼠标按下（PC端）
            block.addEventListener('mousedown', () => {
                startPress(block);
            });

            // 触摸结束（移动端）
            block.addEventListener('touchend', (e) => {
                e.preventDefault();
                endPress(block, e);
            });

            // 鼠标松开/离开（PC端）
            block.addEventListener('mouseup', (e) => endPress(block, e));
            block.addEventListener('mouseleave', () => endPress(block));

            // 点击事件（兼容PC+移动端）
            block.addEventListener('click', (e) => {
                e.preventDefault();
                // 若触发了长按，则跳过点击逻辑
                if (isLongPress) {
                    isLongPress = false;
                    return;
                }
                handleScoreEdit(block);
            });
        }

        // 开始按压逻辑
        function startPress(block) {
            isLongPress = false;
            // 启动长按计时器
            pressTimer = setTimeout(() => {
                isLongPress = true; // 标记为长按
                block.classList.add('long-press');
                // 检查最小数量
                const blockCount = document.querySelectorAll('.score-block').length;
                if (blockCount <= 2) {
                    alert('至少保留2个计分块');
                    endPress(block);
                    return;
                }
                // 确认删除
                if (confirm('确定删除该计分块吗？')) {
                    block.remove();
                }
                endPress(block);
            }, LONG_PRESS_TIME);
            // 按压反馈
            block.style.backgroundColor = '#34495e';
        }

        // 结束按压逻辑
        function endPress(block, e) {
            clearTimeout(pressTimer);
            pressTimer = null;
            // 恢复样式
            block.classList.remove('long-press');
            block.style.backgroundColor = '#2c3e50';
        }

        // 自定义弹窗（替代prompt，适配移动端）
        function showCustomPrompt() {
            return new Promise((resolve) => {
                // 创建弹窗元素
                const promptEl = document.createElement('div');
                promptEl.className = 'custom-prompt';
                promptEl.innerHTML = `
                    <div class="prompt-dialog">
                        <div class="prompt-title">请输入要添加的分数（增量）</div>
                        <input type="number" class="prompt-input" value="0">
                        <div class="prompt-btns">
                            <button class="prompt-btn btn-cancel">取消</button>
                            <button class="prompt-btn btn-confirm">确认</button>
                        </div>
                    </div>
                `;
                document.body.appendChild(promptEl);

                const input = promptEl.querySelector('.prompt-input');
                const cancelBtn = promptEl.querySelector('.btn-cancel');
                const confirmBtn = promptEl.querySelector('.btn-confirm');

                // 自动聚焦输入框
                input.focus();

                // 取消按钮
                cancelBtn.addEventListener('click', () => {
                    document.body.removeChild(promptEl);
                    resolve(null);
                });

                // 确认按钮
                confirmBtn.addEventListener('click', () => {
                    const value = input.value.trim();
                    document.body.removeChild(promptEl);
                    resolve(value);
                });

                // 点击弹窗外部关闭
                promptEl.addEventListener('click', (e) => {
                    if (e.target === promptEl) {
                        document.body.removeChild(promptEl);
                        resolve(null);
                    }
                });

                // 键盘回车确认
                input.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter') {
                        const value = input.value.trim();
                        document.body.removeChild(promptEl);
                        resolve(value);
                    }
                });
            });
        }

        // 编辑分数逻辑（核心）
        async function handleScoreEdit(block) {
            const currentScore = parseInt(block.dataset.score || 0);
            // 显示自定义弹窗
            const addScoreStr = await showCustomPrompt();
            
            // 取消输入
            if (addScoreStr === null || addScoreStr === '') return;
            
            // 校验数字
            const addScore = parseInt(addScoreStr);
            if (isNaN(addScore)) {
                alert('请输入有效的数字！');
                return;
            }
            
            // 计算新分数并更新
            const newScore = currentScore + addScore;
            block.dataset.score = newScore;
            block.textContent = newScore;
        }

        // 添加新计分块
        addBtn.addEventListener('click', () => {
            const currentBlocks = document.querySelectorAll('.score-block').length;
            if (currentBlocks >= 10) {
                alert('最多支持10人计分');
                return;
            }
            const newBlock = document.createElement('div');
            newBlock.className = 'score-block';
            newBlock.dataset.score = '0';
            newBlock.textContent = '0';
            // 绑定事件
            initBlockEvents(newBlock);
            // 插入到添加按钮前
            scoreContainer.insertBefore(newBlock, addBtn);
        });

        // 清空所有分数
        clearBtn.addEventListener('click', () => {
            document.querySelectorAll('.score-block').forEach(block => {
                block.dataset.score = '0';
                block.textContent = '0';
            });
        });

        // 初始化现有计分块
        document.querySelectorAll('.score-block').forEach(block => {
            initBlockEvents(block);
        });

        // 解决移动端300ms点击延迟
        if ('ontouchstart' in window) {
            document.addEventListener('touchstart', () => {}, { passive: false });
        }
    </script>
</body>
</html>